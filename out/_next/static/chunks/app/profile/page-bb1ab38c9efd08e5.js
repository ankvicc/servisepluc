(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{9671:function(e,t,s){Promise.resolve().then(s.bind(s,4286))},8198:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(7437),r=s(5879),l=s(2265),n=s(4033);function o(e){let{onSuccess:t,onBack:s}=e,[r,n]=(0,l.useState)({name:"",email:"",password:""}),[o,i]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)(!1),x=e=>{let{name:t,value:s}=e.target;n(e=>({...e,[t]:s}))},h=async e=>{e.preventDefault(),c(!0),i("");try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await e.json();if(!e.ok)throw Error(s.error||"Ошибка при регистрации");i("Регистрация успешна!"),t&&t()}catch(e){i(e instanceof Error?e.message:"Ошибка при регистрации")}finally{c(!1)}};return(0,a.jsxs)("div",{className:"max-w-md mx-auto p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s&&(0,a.jsx)("button",{onClick:s,className:"text-gray-600 hover:text-gray-800",children:"← Назад"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-center flex-grow",children:"Регистрация"})]}),o&&(0,a.jsx)("div",{className:"mb-4 p-3 rounded text-sm ".concat(o.includes("успешна")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:o}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Имя"}),(0,a.jsx)("input",{type:"text",id:"name",name:"name",value:r.name,onChange:x,className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ваше имя",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:r.email,onChange:x,className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"example@mail.com",required:!0})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Пароль"}),(0,a.jsx)("input",{type:u?"text":"password",id:"password",name:"password",value:r.password,onChange:x,className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"••••••••",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>m(!u),className:"absolute right-2 top-8 text-gray-500 hover:text-gray-700",children:u?"\uD83D\uDE48":"\uD83D\uDC41️"})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)("button",{type:"submit",disabled:d,className:"w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(d?"opacity-70 cursor-not-allowed":""),children:d?"Регистрация...":"Зарегистрироваться"})})]})]})}function i(e){let{onSuccess:t}=e,{login:s}=(0,r.a)(),i=(0,n.useRouter)(),[d,c]=(0,l.useState)({email:"",password:""}),[u,m]=(0,l.useState)(""),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!1),[b,f]=(0,l.useState)(!1),y=e=>{let{name:t,value:s}=e.target;c(e=>({...e,[t]:s}))},j=async e=>{e.preventDefault(),h(!0),m("");try{let e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!e.ok){let t=await e.json();throw Error(t.error||"Ошибка авторизации")}let{token:a}=await e.json();s(a),i.refresh(),i.push("/profile"),t&&t()}catch(e){m(e instanceof Error?e.message:"Ошибка авторизации")}finally{h(!1)}};return b?(0,a.jsx)(o,{onSuccess:()=>{f(!1),t&&t()},onBack:()=>f(!1)}):(0,a.jsxs)("div",{className:"max-w-md mx-auto p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-6",children:"Вход в аккаунт"}),u&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded text-sm",children:u}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:d.email,onChange:y,className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"example@mail.com",required:!0,autoComplete:"username"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Пароль"}),(0,a.jsx)("input",{type:p?"text":"password",id:"password",name:"password",value:d.password,onChange:y,className:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"••••••••",required:!0,autoComplete:"current-password"}),(0,a.jsx)("button",{type:"button",onClick:()=>g(!p),className:"absolute right-2 top-8 text-gray-500 hover:text-gray-700",children:p?"\uD83D\uDE48":"\uD83D\uDC41️"})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)("button",{type:"submit",disabled:x,className:"w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(x?"opacity-70 cursor-not-allowed":""),children:x?"Вход...":"Войти"})})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-4 text-center",children:["Нет аккаунта?"," ",(0,a.jsx)("button",{onClick:()=>f(!0),className:"font-medium text-blue-600 hover:text-blue-500 hover:underline focus:outline-none",children:"Зарегистрироваться"})]})]})}},5879:function(e,t,s){"use strict";s.d(t,{H:function(){return d},a:function(){return c}});var a=s(7437),r=s(2265),l=s(4033),n=s(3822),o=s.n(n);let i=(0,r.createContext)({isAuthenticated:!1,user:null,login:()=>{},logout:()=>{},updateUser:()=>{}}),d=e=>{let{children:t}=e,[s,n]=(0,r.useState)(null),d=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(e)try{let t=o().decode(e);t&&n({id:t.userId})}catch(e){c()}},[]);let c=()=>{localStorage.removeItem("token"),n(null),d.push("/")};return(0,a.jsx)(i.Provider,{value:{isAuthenticated:!!s,user:s,login:e=>{let t=o().decode(e);localStorage.setItem("token",e),n({id:t.userId})},logout:c,updateUser:e=>{n(t=>t?{...t,...e}:null)}},children:t})},c=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},4286:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(7437),r=s(5879),l=s(2265),n=s(4033),o=s(8198);function i(){let{user:e,isAuthenticated:t,logout:s,updateUser:i}=(0,r.a)(),d=(0,n.useRouter)(),[c,u]=(0,l.useState)({name:"",email:"",phone:""}),[m,x]=(0,l.useState)([]),[h,p]=(0,l.useState)(!0),[g,b]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t?e&&(u({name:e.name||"",email:e.email||"",phone:e.phone||""}),f(e.id),p(!1)):p(!1)},[t,d,e]);let f=async e=>{try{let t=await fetch("/api/orders/".concat(e)),s=await t.json();x(s)}catch(e){console.error("Error fetching orders:",e)}},y=async()=>{if(e){b(!0);try{await i({id:e.id,...c})}catch(e){console.error("Update failed:",e)}finally{b(!1)}}};return t?h?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Личные данные"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2",children:"Имя"}),(0,a.jsx)("input",{value:c.name,onChange:e=>u({...c,name:e.target.value}),className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2",children:"Email"}),(0,a.jsx)("input",{value:c.email,className:"w-full p-2 border rounded bg-gray-100",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2",children:"Телефон"}),(0,a.jsx)("input",{value:c.phone,onChange:e=>u({...c,phone:e.target.value}),className:"w-full p-2 border rounded"})]})]}),(0,a.jsx)("button",{onClick:y,disabled:g,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-blue-300 transition",children:g?"Сохранение...":"Сохранить изменения"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Мои заказы"}),m.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Номер заказа"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Дата"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Статус"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Сумма"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",e.orderNumber]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                          ".concat("completed"===e.status?"bg-green-100 text-green-800":"processing"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.total.toFixed(2)," ₽"]})]},e.id))})]})}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"У вас пока нет заказов"})]})]})}):(0,a.jsx)(o.Z,{onSuccess:()=>p(!1)})}}},function(e){e.O(0,[218,115,971,596,744],function(){return e(e.s=9671)}),_N_E=e.O()}]);